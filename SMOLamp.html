<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>SMOLamp ‚Äî Gest√£o Integrada</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Sistema de Gest√£o Integrada da Secretaria de Obras (Arquivos e Ilumina√ß√£o)">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1e293b"> <link rel="icon" type="image/png" href="SMOLamp.png">
<link rel="apple-touch-icon" href="SMOLamp.png">

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/docx@8.3.0/build/index.min.js"></script>

<style>
/* ================= ESTILOS GERAIS DO SISTEMA INTEGRADO ================= */
body { font-family: Arial, Helvetica, sans-serif; background: #f1f5f9; margin: 0; padding: 20px; min-height: 100vh; box-sizing: border-box;}

/* Barra de Navega√ß√£o Superior */
.main-nav {
    background: #1e293b;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 20px;
    display: flex;
    gap: 10px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    align-items: center;
}
.nav-logo { height: 40px; margin-right: 10px; }

.nav-btn {
    background: #334155;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: 0.2s;
    width: auto; /* Override do estilo global */
    margin-top: 0; /* Override */
    flex-grow: 1; /* Bot√µes ocupam espa√ßo igual no celular */
    text-align: center;
}
.nav-btn:hover { background: #475569; }
.nav-btn.active { background: #2563eb; ring: 2px solid white; }

/* Controle de Visibilidade dos M√≥dulos */
.app-module { display: none; }
.app-module.active { display: block; animation: fadeIn 0.3s; }

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* ========================================================================== */
/* ESTILOS DO M√ìDULO ARQUIVOS */
/* ========================================================================== */
header{background:#0f172a;color:#fff;padding:15px;border-radius:8px;margin-bottom:20px}
h1{margin:0;font-size:1.4em}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:20px; flex-grow: 1;}
.env{background:#fff;padding:15px;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,.15)}
.env h2{margin-top:0}
label{font-weight:bold; display:block; margin-top:10px;}
input,button{width:100%;padding:8px;margin-top:6px; box-sizing: border-box;}
button{background:#2563eb;color:#fff;border:none;border-radius:6px;cursor:pointer; padding: 10px;}
button:hover{background:#1d4ed8;}
table{width:100%;border-collapse:collapse;font-size:.85em;margin-top:10px}
th,td{border-bottom:1px solid #e2e8f0;padding:6px;vertical-align:top}
th{background:#f8fafc}
.endereco{font-weight:bold;white-space:pre-wrap}

#resM2 { margin-top: 15px; max-height: 600px; overflow-y: auto; padding-right: 5px; }
#resM2::-webkit-scrollbar { width: 8px; }
#resM2::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
#statusM2 { font-size: 0.9em; color: #ea580c; font-weight: bold; margin-top: 5px; min-height: 20px; }
.card-arquivo { background: #fff; border: 1px solid #e2e8f0; border-left: 5px solid #10b981; border-radius: 6px; padding: 15px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: transform 0.1s; }
.card-arquivo:hover { transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-color: #10b981; }
.doc-titulo { display: block; font-size: 1.1rem; font-weight: 800; color: #1e293b; margin-bottom: 8px; line-height: 1.3; }
.doc-meta { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px; align-items: center; }
.tag-contexto { background: #dbeafe; color: #1e40af; font-weight: bold; font-size: 0.85rem; padding: 6px 10px; border-radius: 4px; text-transform: uppercase; border: 1px solid #bfdbfe; width: 100%; display: block; word-wrap: break-word; }
.tag-item { background: #10b981; color: white; font-weight: bold; font-size: 0.8rem; padding: 4px 8px; border-radius: 4px; white-space: nowrap; }
.doc-info-extra { font-size: 0.85rem; color: #64748b; margin-bottom: 10px; font-style: italic; padding-bottom: 5px; border-bottom: 1px solid #f1f5f9; }
.doc-local { display: flex; gap: 15px; font-size: 0.9rem; font-weight: 600; color: #475569; background: #f8fafc; padding: 8px; border-radius: 4px; align-items: center; }

/* Rodap√© Unificado */
footer.AppFooter { margin-top: 30px; background: #fff; padding: 15px 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,.15); display: flex; justify-content: space-between; align-items: center; color: #334155; font-weight: bold; font-size: 0.9em; border-top: 4px solid #0f172a; }
.footer-logo { height: 50px; width: auto; object-fit: contain; }
.footer-text { text-align: center; text-transform: uppercase; letter-spacing: 0.5px; margin: 0 10px; }

/* ========================================================================== */
/* ESTILOS DO M√ìDULO ILUMINA√á√ÉO */
/* ========================================================================== */
.card{background:#fff;padding:15px;border-radius:8px;margin-bottom:20px;box-shadow:0 1px 3px rgba(0,0,0,.1)}
.kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:15px}
.kpi{text-align:center;border-bottom:5px solid #94a3b8; padding-bottom: 10px;}
.kpi .valor{font-size:1.8em;font-weight:bold; display: block;}
.azul{border-color:#2563eb;color:#2563eb}
.verde{border-color:#16a34a;color:#16a34a}
.vermelho{border-color:#dc2626;color:#dc2626}
.laranja{border-color:#f59e0b;color:#f59e0b}
.badge{padding:3px 8px;border-radius:12px;font-size:.75em;font-weight:bold}
.feito{background:#dcfce7;color:#166534}
.pendente{background:#fee2e2;color:#991b1b}
.btn-group { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
.btn-group button { width: auto; flex-grow: 1; }

/* Responsividade para celulares */
@media (max-width: 768px) {
  .grid, .kpis { grid-template-columns: 1fr; }
  footer.AppFooter { flex-direction: column; gap: 15px; text-align: center; }
  .main-nav { flex-wrap: wrap; justify-content: center; }
  .nav-logo { display: none; } /* Esconde logo do menu em telas pequenas */
}
</style>
</head>

<body>

<nav class="main-nav">
  <img src="SMOLamp.png" alt="Logo SMOLamp" class="nav-logo">
  <button class="nav-btn active" onclick="switchModule('arquivos', this)">üìÇ Arquivos</button>
  <button class="nav-btn" onclick="switchModule('iluminacao', this)">üí° Ilumina√ß√£o</button>
</nav>

<div id="module-arquivos" class="app-module active">
    <header><h1>SMOLamp Arquivos</h1></header>
    <div class="grid">
        <div class="env">
            <h2>Ambiente 1 ‚Äî Planilhas com Abas</h2>
            <label>Arquivo (Modelo 1)</label>
            <input type="file" id="fileM1" accept=".xlsx,.xls">
            <label>Busca</label>
            <input type="text" id="buscaM1">
            <button onclick="buscarM1()">Buscar</button>
            <table>
                <thead><tr><th>Item</th><th>Documento</th><th>Endere√ßo f√≠sico completo</th></tr></thead>
                <tbody id="resM1"></tbody>
            </table>
        </div>
        <div class="env" style="border-top: 4px solid #10b981;">
            <h2>Ambiente 2 ‚Äî Arquivo Geral</h2>
            <label>Arquivo (Rela√ß√£o Geral)</label>
            <input type="file" id="fileM2" accept=".xlsx,.xls,.csv">
            <div id="statusM2"></div>
            <label>Busca Generalizada</label>
            <input type="text" id="buscaM2" disabled placeholder="Aguardando arquivo...">
            <div id="resM2">
                <div style="text-align:center; color:#999; margin-top:20px;">Carregue a planilha geral</div>
            </div>
        </div>
    </div>
</div> 

<div id="module-iluminacao" class="app-module">
    <header><h1>SMOLamp Ilumina√ß√£o P√∫blica</h1></header>
    <div class="card">
        <label>Carregar Planilha de Pedidos</label>
        <input type="file" id="fileUpload" accept=".xlsx,.xls,.csv">
    </div>

    <div class="card kpis">
        <div class="kpi azul"><span class="valor" id="kTotal">0</span>Total</div>
        <div class="kpi vermelho"><span class="valor" id="kPendentes">0</span>Pendentes</div>
        <div class="kpi verde"><span class="valor" id="kFeitos">0</span>Executados</div>
        <div class="kpi laranja"><span class="valor" id="kEficiencia">0%</span>Efici√™ncia</div>
    </div>

    <div class="grid">
        <div class="card">
            <h3>Filtros e Relat√≥rios</h3>
            <label>Data inicial</label><input type="date" id="dataInicio">
            <label>Data final</label><input type="date" id="dataFim">
            <label>Dias de chuva a descontar</label><input type="number" id="diasChuva" min="0" value="0">
            <label style="display:flex; align-items:center; gap:10px; margin-top:15px;">
                <input type="checkbox" id="somentePendentes" style="width:auto; margin:0;"> Mostrar apenas pendentes
            </label>
            <button onclick="processar()" style="background:#0f172a; margin-top:15px;">üîÑ Processar Dados</button>

            <div class="btn-group">
                <button onclick="exportarPDF()">üìÑ PDF Completo</button>
                <button onclick="exportarPDFResumo()">üìë PDF Sint√©tico</button>
                <button onclick="exportarDOCX()">üìù DOCX</button>
            </div>
            <p id="medias" style="margin-top:20px; font-weight:bold; color:#334155;"></p>
            <canvas id="canvasTipos" height="200"></canvas>
            <canvas id="canvasSemanal" height="200"></canvas>
            <canvas id="canvasAcumulado" height="200"></canvas>
        </div>

        <div class="card">
            <h3>Registros Filtrados</h3>
            <div style="overflow-x: auto;">
                <table>
                    <thead><tr><th>Data</th><th>OS</th><th>Rua</th><th>Bairro</th><th>Descri√ß√£o</th><th>Status</th></tr></thead>
                    <tbody id="tabela"></tbody>
                </table>
            </div>
            <div id="
